<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT-ESP8266</title>
    <!--Incluir bootstrap-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
          <a class="navbar-brand" href="/index.html">
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-robot" viewBox="0 0 16 16">
              <path d="M6 12.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5ZM3 8.062C3 6.76 4.235 5.765 5.53 5.886a26.58 26.58 0 0 0 4.94 0C11.765 5.765 13 6.76 13 8.062v1.157a.933.933 0 0 1-.765.935c-.845.147-2.34.346-4.235.346-1.895 0-3.39-.2-4.235-.346A.933.933 0 0 1 3 9.219V8.062Zm4.542-.827a.25.25 0 0 0-.217.068l-.92.9a24.767 24.767 0 0 1-1.871-.183.25.25 0 0 0-.068.495c.55.076 1.232.149 2.02.193a.25.25 0 0 0 .189-.071l.754-.736.847 1.71a.25.25 0 0 0 .404.062l.932-.97a25.286 25.286 0 0 0 1.922-.188.25.25 0 0 0-.068-.495c-.538.074-1.207.145-1.98.189a.25.25 0 0 0-.166.076l-.754.785-.842-1.7a.25.25 0 0 0-.182-.135Z"/>
              <path d="M8.5 1.866a1 1 0 1 0-1 0V3h-2A4.5 4.5 0 0 0 1 7.5V8a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1v1a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-1a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1v-.5A4.5 4.5 0 0 0 10.5 3h-2V1.866ZM14 7.5V13a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7.5A3.5 3.5 0 0 1 5.5 4h5A3.5 3.5 0 0 1 14 7.5Z"/>
            </svg>
            IoT-ESP8266
          </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="/index.html">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="/test.html">Test</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="https://github.com/lelequinter/IoT-ESP8266" target="_blank">GitHub Repository</a>
              </li>
              <li class="nav-item">
                <a class="nav-link disabled">By: lelequinter</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!--App de Vue-->
  <div id="app">
        <!--Cards de los datos-->
      <div class="container mt-5">
        <h1>Monitoreo de Variables</h1> 
        <div class="row ">
          
            <div class="col-md justify-content mb-4">
              <div class="card text-white bg-danger mx-auto text-center" style="max-width: 20rem;">
                <div class="card-header" id="cardtemp">Temperatura</div>
                <div class="card-body">
                  <div class="container">
                    <div class="row">
                      <div class="col" id="temp">
                        <h1 class="card-title display-3">{{this.temperatura}}</h1>
                      </div>
                      <div class="col">
                        <h4 class="card-title">°C</h4>
                      </div>
                    </div>
                  </div>    
                </div>
              </div>
            </div>

            <div class="col-md mb-4">
              <div class="card text-white bg-primary mx-auto text-center" style="max-width: 20rem;">
                <div class="card-header" id="cardhume">Humedad</div>
                <div class="card-body">
                  <div class="container">
                    <div class="row">
                      <div class="col" id="hume">
                        <h1 class="card-title display-3">{{this.humedad}}</h1>
                      </div>
                      <div class="col">
                        <h4 class="card-title">%</h4>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md mb-4">
              <div class="card text-white bg-warning mx-auto text-center" style="max-width: 20rem;">
                <div class="card-header" id="cardpres">Presion</div>
                <div class="card-body">
                  <div class="container">
                    <div class="row">
                      <div class="col" id="pres">
                        <h1 class="card-title display-3">{{this.presion}}</h1>
                      </div>
                      <div class="col">
                        <h4 class="card-title">Pa</h4>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
        </div>

        <div class="container mt-5">
          <div class="row ">
            <v-chart id="TempGraph" :options="Graph_temp"/>
          </div>
        </div>
      
    </div>  
  </div>
      <!--Script de añadir VUE-->
      <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
      <!--Script de Bootstrap-->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
      <!--Añadimos las librerias de Vue eCharts-->
      <script src="https://cdn.jsdelivr.net/npm/echarts@4.1.0/dist/echarts.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/vue-echarts@4.0.2"></script>
      <!--Objeto de VUE-->
      <script type="module">        
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, set, ref, child, get, onValue} from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyDG8VbFbilo5Wo6e9NLIKjuUCt-kqvOrs8",
          authDomain: "iot-esp-8266-45f27.firebaseapp.com",
          databaseURL: "https://iot-esp-8266-45f27-default-rtdb.firebaseio.com",
          projectId: "iot-esp-8266-45f27",
          storageBucket: "iot-esp-8266-45f27.appspot.com",
          messagingSenderId: "886952507313",
          appId: "1:886952507313:web:d39ae76138825abfc8af90",
          measurementId: "${config.measurementId}"
        };
        //Inicializar Firebase
        const firebase = initializeApp(firebaseConfig);

        const app = new Vue({
          el:'#app',
          components: {
                    "v-chart": VueECharts
            },
          data:{
            titleApp: 'IoT_ESP8266',
            temperatura: 0,
            humedad: 0,
            presion: 0,
            Graph_temp : {
                    title: {
                      text: 'Grafica Temperatura'
                    },
                    xAxis: {
                        type: 'category',
                        data: []
                    },
                    yAxis: {
                        type: 'value'
                    },
                    series: [
                        {
                        data: [],
                        type: 'line'
                        }
                    ]
            },
            
          },
          computed:{

          },
          mounted(){
            this.getData()
            this.fillGraph()
          },
          methods:{
            //Obtenemos los datos de la DataBase y los visualizamos en la consola
            getData: function(){
              const db = getDatabase();
              onValue(ref(db, '/casa/'),(snapshot) => {
                //console.log(snapshot.val().humedad); //para mirar el la consola lo que se lee
                this.temperatura = snapshot.val().temperatura;
                this.humedad = snapshot.val().humedad;
                this.presion = snapshot.val().presion;
                },{
                onlyOnce: false
              });
            },
            fillGraph(){
                const db = getDatabase();
                onValue(ref(db, '/casa_log/temperatura'), (snapshot) => {
                    this.Graph_temp.xAxis.data = [];
                    this.Graph_temp.series[0].data = [];

                    snapshot.forEach((item)=>{
                        this.Graph_temp.xAxis.data.push("Temp #"+item.val());
                        this.Graph_temp.series[0].data.push(item.val());
                    })
                    }, {
                    onlyOnce: false
                    });
                console.log(this.Graph_temp.xAxis.data);
            },
          },
        });
        
      </script>

</body>
</html>